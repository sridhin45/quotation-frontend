<h2 style="text-align: center; color: green;">
  {{ mode === 'add' ? 'Create Quotation' : 'Edit Quotation' }}
</h2>

<form (ngSubmit)="submit()" class="quote-form">
  
  <div class="section">
    <div class="row">
      <div class="field">
        <label>Customer Name</label>
        <input type="text" [(ngModel)]="customerName" name="customerName" required />
      </div>

      <div class="field">
        <label>Customer Phone</label>
        <input type="text" [(ngModel)]="customerPhone" name="customerPhone" />
      </div>

      <div class="field">
        <label>Salesman Name</label>
        <input type="text" [(ngModel)]="salesmanName" name="salesmanName" required />
      </div>

      <div class="field">
        <label>Tax (%)</label>
        <input type="number" [(ngModel)]="tax" name="tax" />
      </div>
    </div>
  </div>

  <hr>

  <!-- ITEM LOOP -->
  <div *ngFor="let item of items; let i = index" class="item-card">
    <h4>
      Item {{ i + 1 }}

      <button type="button" class="icon-btn delete" *ngIf="items.length > 1" (click)="removeItem(i)">
        <mat-icon>delete</mat-icon>
      </button>
    </h4>

    <div class="row">

      <!-- NAME + AUTOCOMPLETE -->
      <div class="field large">
        <label>Name Of The Item</label>

        <input 
          type="text"
          [(ngModel)]="item.description"
          name="item{{i}}"
          (input)="onItemSearch($event, i)"
          (focus)="focusedIndex = i"
          autocomplete="off"
        />

  <ul class="suggestion-box"
    *ngIf="focusedIndex === i && itemSuggestions[i]?.length">

  <li *ngFor="let s of itemSuggestions[i]"
      (mousedown)="selectItemMaster(s, i)">

    <img *ngIf="s.image"
         [src]="'https://quotation-backend-e2jd.onrender.com/uploads/' + s.image"
         width="35" height="35"
         style="object-fit: cover; margin-right: 8px;" />

    {{ s.name }} — ₹{{ s.unit_price }}
  </li>
</ul>

      </div>

      <!-- QTY -->
      <div class="field small">
        <label>Qty</label>
        <input type="number" [(ngModel)]="item.quantity" name="q{{i}}" min="1" />
      </div>

      <!-- UNIT PRICE -->
      <div class="field small">
        <label>Unit Price</label>
        <input type="number" [(ngModel)]="item.unit_price" name="p{{i}}" min="0" />
      </div>

      <!-- IMAGE -->
      <div class="field">
        <label>Product Image</label>

        <img *ngIf="item.image && !item.imageFile"
             [src]="'https://quotation-backend-1-eewh.onrender.com/uploads/' + item.image"
             width="80" height="80"
             style="object-fit: cover; border-radius: 6px;" />

        <img *ngIf="item.imageFile"
             [src]="previewImage(item.imageFile)"
             width="80" height="80"
             style="object-fit: cover; border-radius: 6px;" />

        <input type="file" (change)="onItemImageSelected($event, i)" />
      </div>

    </div>

    <hr>
  </div>

  <!-- ADD ITEM BUTTON -->
  <button type="button" class="add-btn" (click)="addItem()">
    <mat-icon>add</mat-icon>
    Add Item
  </button>

  <!-- SUBMIT BUTTON -->
  <button type="submit" class="submit-btn" [disabled]="isSubmitting">
    <mat-icon>{{ mode === 'add' ? 'send' : 'save' }}</mat-icon>
    {{ mode === 'add' ? 'Create Quotation' : 'Update Quotation' }}
  </button>

</form>
