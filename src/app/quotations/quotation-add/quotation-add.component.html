
<div class="container">
<h2 style="text-align:center; color:green">
  {{ mode === 'add' ? 'Create Quotation' : 'Edit Quotation' }}
</h2>

<form (ngSubmit)="submit()" class="quote-form">

  <!-- ================= HEADER ================= -->
  <div class="section">
    <div class="row">
      <div class="field">
        <label>Customer Name</label>
        <input type="text" [(ngModel)]="customerName" name="customerName" required />
      </div>

      <div class="field">
        <label>Customer Phone</label>
        <input type="text" [(ngModel)]="customerPhone" name="customerPhone" />
      </div>

      <div class="field">
        <label>Salesman Name</label>
        <input type="text" [(ngModel)]="salesmanName" name="salesmanName" required />
      </div>

      <div class="field">
        <label>Tax (%)</label>
        <input type="number" [(ngModel)]="tax" name="tax" />
      </div>
    </div>
  </div>

  <hr />

  <!-- ================= ITEMS ================= -->
  <div *ngFor="let item of items; let i = index" class="item-card">

    <h4>
      Item {{ i + 1 }}

    </h4>

    <div class="row">

      <!-- ITEM NAME + AUTOCOMPLETE -->
      <div class="field large">
        <label>Item Name</label>

        <input
          type="text"
          [(ngModel)]="item.item_name"
          name="item{{i}}"
          (input)="onItemSearch($event, i)"
          (focus)="focusedIndex = i"
          autocomplete="off" />

        <ul
          class="suggestion-box"
          *ngIf="focusedIndex === i && itemSuggestions[i]?.length">

          <li
            *ngFor="let s of itemSuggestions[i]"
            (mousedown)="selectItemMaster(s, i)">

    <img
  *ngIf="s.image"
  [src]="s.image"
  width="35" height="35"
  style="object-fit:cover; margin-right:8px" />


            {{ s.name }} — ₹{{ s.unit_price }}
          </li>
        </ul>
      </div>

      <!-- QTY -->
      <div class="field small">
        <label>Qty</label>
        <input
          type="number"
          [(ngModel)]="item.qty"
          name="qty{{i}}"
          min="1"
          (input)="recalculate(i)" />
      </div>

      <!-- PRICE -->
      <div class="field small">
        <label>Unit Price</label>
        <input
          type="number"
          [(ngModel)]="item.price"
          name="price{{i}}"
          min="0"
          (input)="recalculate(i)" />
      </div>

      <!-- IMAGE -->
   <!-- IMAGE -->
<div class="field">
  <label>Product Image</label>

  <!-- Preview (new upload) -->
  <img *ngIf="item.previewUrl"
       [src]="item.previewUrl"
       width="80" height="80"
       style="object-fit:cover; border-radius:6px" />

  <!-- Existing Cloudinary image -->
  <img *ngIf="item.image && !item.previewUrl"
       [src]="item.image"
       width="80" height="80"
       style="object-fit:cover; border-radius:6px" />

  <input type="file" (change)="onItemImageSelected($event, i)" />
</div>

<!-- ADD ITEM INLINE -->



    </div>
<div class="item-actions-row">
        <button
        type="button"
        class="icon-btn delete"
        *ngIf="items.length > 1"
        (click)="removeItem(i)">
        <mat-icon>delete</mat-icon>
      </button>
  <button type="button"
          class="add-item-inline"
          (click)="addItem()">
    <mat-icon>add</mat-icon>
    Add Item
  </button>
</div>
    <hr />
  </div>

  <!-- ================= ACTIONS ================= -->
<!-- SUBMIT ACTION -->
<div class="submit-row">
  <button type="submit"
          class="submit-btn-small"
          [disabled]="isSubmitting">
    {{ mode === 'add' ? 'Create Quotation' : 'Update Quotation' }}
  </button>
</div>


</form>
</div>